From 88f1454c2d055bfd013f67608fd66bef5d95dec9 Mon Sep 17 00:00:00 2001
From: Martin Herkt <lachs0r@srsfckn.biz>
Date: Sat, 19 Oct 2013 20:03:42 +0200
Subject: [PATCH] Fix stpcpy check on MinGW-w64

---
 configure.ac         | 3 ++-
 src/g10lib.h         | 6 +++---
 src/missing-string.c | 2 +-
 3 files changed, 6 insertions(+), 5 deletions(-)

diff --git a/configure.ac b/configure.ac
index 1460dfd..dc49e86 100644
--- a/configure.ac
+++ b/configure.ac
@@ -1137,7 +1137,8 @@ fi
 
 AC_FUNC_VPRINTF
 # We have replacements for these in src/missing-string.c
-AC_CHECK_FUNCS(stpcpy strcasecmp)
+AC_CHECK_DECLS(stpcpy)
+AC_CHECK_FUNCS(strcasecmp)
 # We have replacements for these in src/g10lib.h
 AC_CHECK_FUNCS(strtoul memmove stricmp atexit raise)
 # Other checks
diff --git a/src/g10lib.h b/src/g10lib.h
index 3b09448..64c5deb 100644
--- a/src/g10lib.h
+++ b/src/g10lib.h
@@ -40,7 +40,7 @@
 #include "types.h"
 
 
-
+
 
 /* Attribute handling macros.  */
 
@@ -88,7 +88,7 @@
 #define DIM(v) (sizeof(v)/sizeof((v)[0]))
 #define DIMof(type,member)   DIM(((type *)0)->member)
 
-
+
 
 /*-- src/global.c -*/
 int _gcry_global_is_operational (void);
@@ -222,7 +222,7 @@ gpg_err_code_t _gcry_generate_fips186_3_prime
 
 
 /* Replacements of missing functions (missing-string.c).  */
-#ifndef HAVE_STPCPY
+#ifndef HAVE_DECL_STPCPY
 char *stpcpy (char *a, const char *b);
 #endif
 #ifndef HAVE_STRCASECMP
diff --git a/src/missing-string.c b/src/missing-string.c
index 4756c00..c70dbca 100644
--- a/src/missing-string.c
+++ b/src/missing-string.c
@@ -28,7 +28,7 @@
 #include "g10lib.h"
 
 
-#ifndef HAVE_STPCPY
+#ifndef HAVE_DECL_STPCPY
 char *
 stpcpy(char *a,const char *b)
 {
-- 
1.8.4

