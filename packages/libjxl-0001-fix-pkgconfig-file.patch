From e837c0fbaf62dbf2ca066e790c1d0873eb628812 Mon Sep 17 00:00:00 2001
From: shinchiro <shinchiro@users.noreply.github.com>
Date: Wed, 4 May 2022 10:12:50 +0800
Subject: [PATCH] fix pkgconfig file & fix static library name

---
 lib/jxl.cmake                    | 2 +-
 lib/jxl/libjxl.pc.in             | 3 ++-
 lib/jxl_threads.cmake            | 2 +-
 lib/threads/libjxl_threads.pc.in | 3 ++-
 4 files changed, 6 insertions(+), 4 deletions(-)

diff --git a/lib/jxl.cmake b/lib/jxl.cmake
index 17096bd..a882d93 100644
--- a/lib/jxl.cmake
+++ b/lib/jxl.cmake
@@ -526,7 +526,7 @@ endif()  # JPEGXL_ENABLE_TCMALLOC
 
 # Install the static library too, but as jxl.a file without the -static except
 # in Windows.
-if (NOT WIN32)
+if (NOT MSVC)
   set_target_properties(jxl-static PROPERTIES OUTPUT_NAME "jxl")
   set_target_properties(jxl_dec-static PROPERTIES OUTPUT_NAME "jxl_dec")
 endif()
diff --git a/lib/jxl/libjxl.pc.in b/lib/jxl/libjxl.pc.in
index a2a6cb5..5f1003d 100644
--- a/lib/jxl/libjxl.pc.in
+++ b/lib/jxl/libjxl.pc.in
@@ -8,5 +8,6 @@ Description: Loads and saves JPEG XL files
 Version: @JPEGXL_LIBRARY_VERSION@
 Requires.private: @JPEGXL_LIBRARY_REQUIRES@
 Libs: -L${libdir} -ljxl
-Libs.private: -lm
+Libs.private: -lm -lstdc++
 Cflags: -I${includedir}
+Cflags.private: -DJXL_STATIC_DEFINE
diff --git a/lib/jxl_threads.cmake b/lib/jxl_threads.cmake
index 037a88d..f510433 100644
--- a/lib/jxl_threads.cmake
+++ b/lib/jxl_threads.cmake
@@ -40,7 +40,7 @@ set_target_properties(${_target} PROPERTIES
 
 # Always install the library as jxl_threads.{a,so} file without the "-static"
 # suffix, except in Windows.
-if (NOT WIN32)
+if (NOT MSVC)
   set_target_properties(${_target} PROPERTIES OUTPUT_NAME "jxl_threads")
 endif()
 install(TARGETS ${_target}
diff --git a/lib/threads/libjxl_threads.pc.in b/lib/threads/libjxl_threads.pc.in
index 4abd783..573cf4e 100644
--- a/lib/threads/libjxl_threads.pc.in
+++ b/lib/threads/libjxl_threads.pc.in
@@ -8,5 +8,6 @@ Description: JPEG XL multi-thread runner using std::threads.
 Version: @JPEGXL_LIBRARY_VERSION@
 Requires.private: @JPEGXL_THREADS_LIBRARY_REQUIRES@
 Libs: -L${libdir} -ljxl_threads
-Libs.private: -lm
+Libs.private: -lm -lstdc++
 Cflags: -I${includedir}
+Cflags.private: -DJXL_THREADS_STATIC_DEFINE
-- 
2.36.0

